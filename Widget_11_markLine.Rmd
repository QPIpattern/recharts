---
title: "Widget 11 - markLine"
output: 
  html_document: 
    number_sections: yes
    toc: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

First, you should load `recharts`:
```{r}
library(recharts)
```

# Introduction

Proper marklines makes a chart more informative. We can use `addMarkLine` (or `addML` for short) to add markLines series by series, timeline by timeline. We can also use `overrideMarkLine` (or `overrideML` for short) to override existing markLines.

# Function Call

```r
addMarkLine(chart, series = NULL, timeslots = NULL, data = NULL,
  clickable = TRUE, symbol = c("circle", "arrow"), symbolSize = c(2, 4),
  symbolRotate = NULL, large = FALSE, smooth = FALSE, smoothness = 0.2,
  precision = 2, bundling = list(enable = FALSE, maxTurningAngle = 45),
  effect = list(show = FALSE), itemStyle = NULL, mode = c("add",
  "override"), ...)
```

`overrideML` is exactly the same as `addML(mode='override', ...)`.

+-------------+----------------------------------------------------------------+
|   Arg       |  Requirement                                                |
+=============+================================================================+
| **chart**   | Echarts object generated by `echartR` or `echart`.  |
+-------------+----------------------------------------------------------------+
| series      | Numeric (series index) or character (series name), numeric preferred. If set NULL, then apply the markPoint to all the series. |
+-------------+----------------------------------------------------------------+
| timeslots   | Numeric (timeslot index) or character (timeslot name), numeric is preferred. If set NULL, then apply the markPoint to all the timeslots. You can use z for short. |
+-------------+----------------------------------------------------------------+
| data        | Data.frame, the data of the markLines. It must contain the following columns: name1, name2, value / type and/or x1 / xAxis1, y1 / yAxis1, x2 / xAxis2, y2 / yAxis2 and/or series. When series is given, it must be cooresponding to the series argument. |
|             | - **generic**: generic form is columns [name1, name2, value, x1, y1, x2, y2], the minimum form is [name1, x1, y1, x2, y2]  |
|             | - **scatter, line, bar**:  [name1, name2, value, x1, y1, x2, y2] or [name1, type] (type can only be 'max', 'min' or 'average') or [name1, name2, value, xAxis1, yAxis1, xAxis2, yAxis2]  |
|             | - **k, eventRiver**: [name1, name2, value, x1, y1, x2, y2] or [name1, name2, value, xAxis1, yAxis1, xAxis2, yAxis2] |
|             | 0 **map**: [name1, name2, value]. You need to pass in [name1, lng1, lat1], [name2, lng2, lat2] using `addGeoCoord` separately. |
+-------------+----------------------------------------------------------------+
| clickable   | Logical, if the points are clickable. Default TRUE. |
+-------------+----------------------------------------------------------------+
| symbol      | Symbol of the markpoints, refer to `recharts:::validSymbols`. Default 'pin'. |
+-------------+----------------------------------------------------------------+
| symbolSize  | Numeric or vector c(height, width) or JS function. Default 10. |
+-------------+----------------------------------------------------------------+
| symbolRotate| Numeric -180 ~ 180. Default NULL. |
+-------------+----------------------------------------------------------------+
| large       | Logical if large effect is on. Default FALSE. |
+-------------+----------------------------------------------------------------+
| effect      | List. effect configurator of markPoints. Default NULL, which is `list(show=FALSE, type='scale',` `loop=TRUE, period=15, scaleSize=2,` `bounceDistance=10, color=NULL, shadowColor=NULL, shadowBlur=0)` |
+-------------+----------------------------------------------------------------+
| itemStyle   | List. It is a list with the structure `list(normal=list(...), emphasis=list(...))`. Default NULL. |
+-------------+----------------------------------------------------------------+
| mode        | add' or 'override' the data part of markLine to the echarts object. Default 'add'. You can use `overrideMarkLine` to override data part of existing markLine. |
+-------------+----------------------------------------------------------------+
| ...         | Elipsis. |
+-------------+----------------------------------------------------------------+


# Showcase

## Cartesian Coordinate System

The example below is from Basic_Plot_01_Scatterplot. 

```{r}
lm <- with(iris, lm(Petal.Width~Sepal.Width))
pred <- predict(lm, data.frame(Sepal.Width=c(2, 4.5)))
```

We respectively add markLines of max, mean, min of data series 1 ('setosa'), 2 ('versicolor') and 3 ('virginica'). Then we addditionally add markLine of linear regression model.

The fourth markLine calls a special data strucutre: a data.frame containing 'name1', 'value', 'xAxis1', 'yAxis1', 'xAxis2', 'yAxis2'. This is only for Cartesian coordinate system.

```{r}
g = echartr(iris, Sepal.Width, Petal.Width, Species) %>% setToolbox(show=FALSE)
```

<table>
<tr><td>
```{r}
g = g %>% setTheme(width=400, height=300) %>%
    addML(series=1, data=data.frame(name1='Max', type='max'))
g
```
</td><td>
```{r}
g = g %>% 
    addML(series=2, data=data.frame(
        name1='Mean', type='average')) 
g
```
</td></tr>
<tr><td>
```{r}
g = g %>%  addML(series=3, data=data.frame(
    name1='Min', type='min')) 
g
```
</td><td>
```{r}
g %>% addML(series='Linear Reg', data=data.frame(
    name1='Reg', value=lm$coefficients[2], 
    xAxis1=2, yAxis1=pred[1], xAxis2=4.5, yAxis2=pred[2]))
```
</td></tr>
</table>

Since the first three markLines share the same format, except for differing in data, we can combine them into one command.

First, combine the data for the three markLines into a data.frame with valid columns names: 'name1', 'type', 'series', etc., of which 'series' must be corrsponding to the `series` argumnet (i.e. each row of data will be mapped to `series` argument of `addML`).

```{r}
data <- data.frame(
    name1=c('Max', 'Mean', 'Min'), type=c('max', 'average', 'min'),
    series=levels(iris$Species))
echartr(iris, Sepal.Width, Petal.Width, Species) %>%
    addML(series=1:3, data=data) %>%
    addML(series='Linear Reg', data=data.frame(
        name1='Reg', value=lm$coefficients[2], 
        xAxis1=2, yAxis1=pred[1], xAxis2=4.5, yAxis2=pred[2]))
```




## Non-decarsian Coordinate System



# References

<http://echarts.baidu.com/echarts2/doc/option.html#tooltip-line1~series-i(line).markPoint>
